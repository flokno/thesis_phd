\subsection{Heat Transport}
\epigraph{\singlespacing \it ``It seems there is no problem in modern physics for which there are on record as many false starts, and as many theories which overlook some essential feature, as in the problem of the thermal conductivity of [electrically] non-conducting crystals.''}{R.~Peierls, 1960}


Conductive heat transport is the phenomenon of vibrational energy traversing a material when a temperature gradient is applied. As first described by Joseph Fourier in the early 19th century~\cite{Fourier1878}, the heat flux $\b J$ resulting from a stationary temperature gradient $\nabla T$ is directly proportional to this gradient. The proportionality constant is second-rank tensor denoted by $\kappa$ and called the \emph{thermal conductivity}. The defining equation,
\begin{align}
  \b J = - \kappa \nabla T~,
  \label{eq:Fourier}
\end{align}
is called \emph{Fourier's law}. The sign convention is such that the heat flux points ``from hot to cold''. The regime where Eq.\,\eqref{eq:Fourier} is valid is called the \emph{diffusive} regime, as it holds when the temperature gradient is small on microscopic scale, and the sample size is big enough so that boundary effects are negligible~\cite{Kapitza1941a,Antidormi2020}.

It is evident from Eq.\,\eqref{eq:Fourier} that the thermal conductivity $\kappa$ is an explicitly non-equilibrium quantity. As such, it can however be related to equilibrium fluctuations by means of the \emph{fluctuation-dissipation theorem}~\cite{Einstein1905a,Nyquist1928,Callen1951,Kubo1957a}, resulting in the famous Green-Kubo formula~\cite{Green1952,Kubo1957b},
\begin{align}
  \kappa^{\alpha \beta} = \frac{V}{k_{\rm B} T^2} \int_{0}^{\infty} \d t ~
    \braket{J^\alpha (t) J^\beta(0)}_{\rm eq}~.
  \label{eq:GreenKubo}
\end{align}
This formula relates the temporal fluctuations of the macroscopic heat flux $\b J (t)$ as given by an equilibrium ensemble average of the autocorrelation function, $\braket{J^\alpha (t) J^\beta(0)}_{\rm eq}$, to the associated transport coefficient $\kappa$. It is however \emph{a priori} unclear how a microscopic description of the appearing quantities can be obtained. To tackle this question in full, we first show how the Kubo formula emerges in the framework of linear response theory. We then present how a microscopic description of heat in terms of a thermal energy density and an associated, locally conserved current follows, before reviewing the necessary steps to define an \emph{ab initio} heat flux~\cite{Carbogno2016}.

\subsubsection{Linear Response Theory}
The aim of linear response theory is to compute the expected value of a phase-space observable $B$ in presence of an external perturbation driving the system out of equilibrium. The ensemble is characterized by a \emph{distribution function} $f(\Gamma, t)$, where $\Gamma = \set{\b R, \b P}$ is a shorthand for a point in phase space. The expectation value of $B$ is given by
\begin{align}
  \braket{B (t)}_f
    = \int \d \Gamma ~ B (\Gamma) f(\Gamma, t)~,
  \label{eq:lr.B.1}
\end{align}
and we assume without loss of generality that its equilibrium value vanishes,
\begin{align}
\braket{B (t)}_{f^0}
= \int \d \Gamma ~ B (\Gamma) f^0(\Gamma) = 0~,
\label{eq:lr.B0}
\end{align}
where $f^0 (\Gamma)$ is the distribution function of the unperturbed system in thermal equilibrium. In order to calculate Eq.\,\eqref{eq:lr.B.1} in a non-equilibrium situation, we start by defining the Hamiltonian describing the equilibrium dynamics, $H^0$, which we take to be given by the many-body Hamiltonian
\begin{align}
  H^0 (\Gamma) 
    = H^0(\set{\b R, \b P})
    = \sum_I \frac{\b P^2}{2 M_I} + V (\b R)~.
  \label{eq:lr.H0}
\end{align}
The canonical distribution function for the unperturbed system reads
\begin{align}
f^0 (\Gamma) 
= \frac{1}{\mathcal{Z}^0} {\rm e}^{- \beta H^0 (\Gamma)}~,
\label{eq:lr.f0}
\end{align}
where the partition sum $\mathcal{Z}_0$ normalizes the phase-space integral, \mbox{$\int \d \Gamma f^0 (\Gamma) = 1$}.
In the next step, we write the full Hamiltonian as
\begin{align}
  H (\Gamma, t)
   = H^0 (\Gamma) + \lambda H' (\Gamma, t)~,
  \label{eq:lr.H}
\end{align}
where the perturbation is given by some yet unspecified phase-space function $H' (\Gamma, t)$ with explicit time dependence, and $\lambda = 1$ is a bookkeeping parameter that we introduce to count the order in the perturbation.
We write the distribution function in presence of the perturbation as
\begin{align}
  f (\Gamma, t) = f^0(\Gamma) + \lambda \Delta f (\Gamma, t)~,
  \label{eq:lr.f}
\end{align}
where $\Delta f$ is the perturbation in the distribution generated by $H'$. Using that $f^0$ carries no explicit time dependence, the Liouville equation for $\Delta f$ reads~\cite[p. 68]{Tuckerman}
\begin{align}
  \lambda \frac{\d \Delta f}{\d t}
    &= \set{H, f} \nonumber \\
    &= \lambda \set{H^0, \Delta f} 
      + \lambda \set{H', f^0}
      + \mathcal{O}(\lambda^2)~,
  \label{eq:lr.df.1} \\
  \implies
    \frac{\d \Delta f}{\d t}
      &\approx \braket{H^0 , \Delta f} + \set{H' (t), f^0}
  \label{eq:lr.df.2}
\end{align}
where $\set{\cdot , \cdot}$ denotes the Poisson bracket\footnote{See, e.\,g., \cite[p.\,21]{Tuckerman}.}
%\footnote{
%  The Poisson bracket for a system of particles with $3N$ positions $q_i \equiv R_I^\alpha$ and conjugate momenta $p_i \equiv P_I^\alpha$ reads
%  $$
%  \set{A, B} = \sum_{i}
%  \frac{\partial A}{\partial q_i} \frac{\partial B}{\partial p_i}
%  - \frac{\partial A}{\partial p_i} \frac{\partial B}{\partial q_i}~.
%  $$
%  }, 
and in Eq.\,\eqref{eq:lr.df.2} we only keep the terms to linear order in the perturbation.
The solution to this differential equation is found to be\footnote{The solution is given in appendix \ref{app:lr.f}.}~\cite{Kubo1957a}
\begin{align}
  \Delta f (t) 
    = \int_{-\infty}^t {\rm e}^{-\im L^0 (t - t')} \set{H' (t'), f^0}~\d t'~,
  \label{eq:lr.df(t)}
\end{align}
where the Liouville operator $L^0$ is defined by the action $\im L^0 g = \set{g, H^0}$, and $\exp (\im L^0 t)$ propagates a phase-space point $\Gamma$ by a time $t$ according to the equations of motion following from $H^0$.
By splitting the interaction Hamiltonian $H'(t)$ into an operator part $A(\Gamma)$ and an explicitly time dependent force function $F(t)$, $H' (t)=AF(t)$, this expression can be simplified in the canonical ensemble by using that \mbox{$\partial f^0 / \partial H^0 = -\beta f^0$}, which leads to
\begin{align*}
  \set{A, f^0}
%    &= \sum_i \frac{\partial A}{\partial q_i} \frac{\partial f^0}{\partial p_i}
%    - \frac{\partial A}{\partial p_i} \frac{\partial f^0}{\partial q_i} \\
%    &= \sum_i \frac{\partial A}{\partial q_i} \frac{\partial f^0}{\partial H^0} \frac{\partial H^0}{\partial p_i}
%    - \frac{\partial A}{\partial p_i} \frac{\partial f^0}{\partial H^0} \frac{\partial H^0}{\partial q_i} \\
%    &= -\beta f^0 \sum_i
%      \left( \frac{\partial A}{\partial p_i} \dot{q}_i +  \frac{\partial A}{\partial q_i} \dot{p}_i \right) \\
    &= -\beta f^0 \, \frac{\d A}{\d t}~.
\end{align*}
%where in the second step Hamilton's equations of motion have been used.

We are now in the position to formulate the expected response of a phase space observable $B$ to linear order in a perturbation described by the Hamiltonian $H'(t) = A F(t)$,~i.\,e.,~
\begin{align}
\braket{B (t)}_f
    &= \int \d \Gamma ~  B (\Gamma) \Delta f (\Gamma, t) \\
    &= - \beta \int_{-\infty}^t 
      \int \d \Gamma ~ f^0(\Gamma) \, 
       B (\Gamma) \, {\rm e}^{-\im L^0 (\Gamma) (t - t')} \dot{A}(\Gamma) F(t') ~ \d t' \\
    &= - \beta \int_{-\infty}^t 
      \braket{B(t) \dot{A}(t')}_0 F(t') ~ \d t'~,
  \label{eq:lr.dB}
\end{align}
where it was used that $a(t) = {\rm e}^{\im L^0 t} a(0) = a(0) {\rm e}^{-\im L^0 t}$~\cite[p.\,498]{Tuckerman}, and $\braket{\cdot}_0$ denotes a phase-space average with respect to the unperturbed distribution function $f^0 (\Gamma)$.

\paragraph{Conserved densities and currents}
Macroscopic properties of matter are often \emph{extensive},~i.\,e.,~they scale with the system size, and can be described by a locally conserved \emph{density}. Taking the general property $A$ represented by the phase-space observable $A(\Gamma_t)$ evaluated at a time $t$ as an example, we define
\begin{align}
  A (\Gamma_t) = \int_V a (\b r, \Gamma_t) \, \d^3 r~,
  \label{eq:lr.A}
\end{align}
where $a(\b r, \Gamma_t)$ is the \emph{local density} associated with the observable $A$. The notation $\Gamma_t$ highlights that the quantity is implicitly time-dependent because the phase-space point $\Gamma$ evolves in time.\footnote{
	Notation for phase-space functions $f (\Gamma)$:
	\begin{align}
	f(t) &\equiv f(\Gamma (t)) \\
	\frac{\partial f}{\partial t} &= \frac{\d f (\Gamma (t))}{\d t} \equiv \dot{f}(t)
	\end{align}
	} 
When no ambiguity arises, we can therefore just write $a (\b r, t)$. The locally conserved density fulfills a continuity equation
\begin{align}
  \partial_t \, a(\b r, t) = - \b \nabla \cdot \b j_a (\b r, t)~,
  \label{eq:lr.continuity.1}
\end{align}
where $\b j_a (\b r, t)$ is the associated current. From the local current, the macroscopic flux is obtained by spatially averaging over the system volume,
\begin{align}
  \b J (t)
    = \frac{1}{V} \int_V \d^3 r ~ \b j (\b r, t)~,
  \label{eq:lr.J(t)}
\end{align}
where the subscript $a$ was dropped for notational clarity.
Likewise we formulate a local version of the perturbing Hamiltonian \mbox{$H' = A (\Gamma) F(t)$} in the form
\begin{align}
	H' (\Gamma, t) = \int \d^3 r ~ a (\b r, \Gamma) v(\b r, t)~,
	\label{eq:lr.H'}
\end{align}
where $a(\b r, \Gamma)$ represents the density of interest as introduced above, and $v(\b r, t)$ is the local driving force coupling to the system via the density $a (\b r, \Gamma)$.

The local version of linear-response formula given in Eq.\,\eqref{eq:lr.dB} with \mbox{$\Delta B = B \equiv \b J$} ($\braket{\b J} = 0$) reads:
\begin{align}
j^\alpha (\b r , t) 
	& \equiv \braket{j^\alpha (\b r)}_{\Delta f (t)} \\
	&= - \beta \int_{-\infty}^{t} \d t' \int_V \d^3 r' ~ \braket{
			j^\alpha (\b r, \Gamma_t) \dot{a} (\b r', \Gamma_{t'})
		}_0 v (\b r', t')~.
	\label{eq:lr.ja.1}
\end{align}
The time derivative of the density can be eliminated by using the continuity equation~\eqref{eq:lr.continuity.1}, $\dot a = \partial'_\beta j^\beta$ where $\partial'_\beta = \partial/\partial r^{\prime \beta}$, and integrating by parts, so that
\begin{align}
j^\alpha (\b r , t) 
&= - \beta \int_{-\infty}^{t} \d t' \int_V \d^3 r' ~ \braket{
	j^\alpha (\b r, \Gamma_t) j^\beta (\b r', \Gamma_{t'})
}_0 \partial'_\beta v (\b r', t')~.
\label{eq:lr.ja.2}
\end{align}
If we now assume the external driving force $v (\b r, t)$ to be constant in time and homogeneously varying in space such that
\begin{align}
	\partial_\beta v (\b r, t) \equiv f_\beta~,
	\label{eq:lr.force}
\end{align}
and spatially average over Eq.\,\eqref{eq:lr.ja.2} with $\frac{1}{V} \int_V \d^3 r$, we arrive at
\begin{align}
	J^\alpha 
		&= -\beta V \int_{0}^{\infty} 
		\d t
		\braket{
		J^\alpha (\Gamma_t) J^\beta (\Gamma_{0})
	}_0 
	f_\beta~,
	\label{eq:lr.J}
\end{align}
where the stationarity in time was used to shift the lower bound of the integral to $t=0$.
This resembles the well-known macroscopic transport equation
\begin{align}
	J^\alpha =  L^{\alpha \beta} F_\beta~,
		\label{eq:lr.LF}
\end{align}
with
\begin{align}
	L^{\alpha \beta}
		= \frac{V}{k_{\rm B}} \int_{0}^{\infty} 
		\d t \braket{J^\alpha (\Gamma_t) J^\beta (\Gamma_{0})}_0 ~,
	\label{eq:lr.L}
\end{align}
and
\begin{align}
	F_\beta
		= - \frac{f_\beta}{T}~,
	\label{eq:lr.F}
\end{align}
where $J^\alpha$ is the macroscopic generalized current associated with the extensive property $A$, $F_\beta$ is the thermodynamic force, and $L^{\alpha \beta}$ is the associated conductance tensor~\cite{Onsager1931a,Baroni2020a}.

\paragraph{Thermal Conductivity}
After this general exposition, let us now look at the example of the total energy of the system and it's associated energy density,
\begin{align}
	E = \int_V \d^3 r ~ e(\b r)~.
	\label{eq:lr.E}
\end{align}
We are interested in the occuring flux in the presence of a temperature inhomogeneity, which we model by
\begin{align}
	H' (\Gamma) = \frac{1}{T} \int \d^3 r ~ \Delta T (\b r) e(\b r, \Gamma)~,
	\label{eq:lr.Hp.temp}
\end{align}
so that
\begin{align}
	f_\beta = \frac{1}{T} \partial_\beta T (\b r) 
		\stackrel{\eqref{eq:lr.F}}{\implies}
	F_\beta = - \frac{1}{T^2} (\b \nabla T)_\beta ~.
	\label{eq:lr.F.temp}
\end{align}
Using the general transport equation $\b J = L \b F$ with the conductance given by Eq.\,\eqref{eq:lr.L} and $F$ as defined above, we obtain
\begin{align}
	J^\alpha 
		&= - \kappa^{\alpha \beta} (\b \nabla T)_\beta~,
	\label{eq:lr.J.2}
\end{align}
where $\kappa^{\alpha \beta}$ denotes the \emph{thermal conductivity tensor} defined as
\begin{align}
	\kappa^{\alpha \beta}
		&=
		\frac{V}{k_{\rm B} T^2} \int_{0}^{\infty} 
		\d t \braket{J^\alpha (\Gamma_t) J^\beta (\Gamma_{0})}_0 ~.
	\label{eq:GreenKubo}
\end{align}

\subsubsection{Heat Flux Definition}
In order to evaluate the thermal conductivity by means of the Green-Kubo formula, Eq.\,\eqref{eq:GreenKubo}, the  heat flux observable $\b J (\Gamma)$ needs to be defined. We do so by starting from the continuity equation again,
\begin{align}
	\dot{e} (\b r) = - \b \nabla \cdot \b j (\b r)
	\label{eq:hf.cont}
\end{align}
and perform a space Fourier transform defined by the pair of equations
\begin{align}
	e(\b r) 
		&= \int \d^3 q ~ e(\b q) \, {\rm e}^{\im \b q \cdot \b r} ~,
		\label{eq:hf.ft.r} \\
	\Leftrightarrow
	e(\b q) 
		&= \frac{1}{V} \int \d^3 r ~ e(\b r) \, {\rm e}^{-\im \b q \cdot \b r} ~,
	\label{eq:hf.ft.2}
\end{align}
so that the continuity equation can be rewritten for the Fourier components as
\begin{align}
	\dot{e} (\b q)
		= - \im \b q \cdot \b j (\b q)~.
	\label{eq:hf.ft.cont.q}
\end{align}
We split the total current into a longitudinal, heat-carrying component $\b j_{\parallel}$ and a transverse current $\b j_{\perp}$,
\begin{align}
	\b j = \frac{\b q}{q} j_{\parallel} + \b j_{\perp} \quad\text{where}\quad \b q \cdot \b j_{\perp} = 0~,
\end{align}
so that
\begin{align}
	\b j_{\parallel} 
		= -\im \frac{\b q}{q^2} \dot{e} (\b q)~.
\end{align}
As before, we obtain the macroscopic heat flux as a spatial average of the (longitudinal) current,
\begin{align}
	\b J (t) = \frac{1}{V} \int \d^3 r ~ \b j_{\parallel} (\b r) = \b j_{\parallel} (\b q \to 0)~,
	\label{eq:hf.J.1}
\end{align}
i.\,e.,~the long wavelength limit of the current in reciprocal space. The long wavelength limit for the time derivative of the local energy density is
\begin{align}
	\dot{e} (\b q \to 0) 
		= \lim_{\b q \to 0} \int \d^3 r \left(\cancel{1} - \im \b q \cdot \b r + (\b q \cdot \b r)^2 + \cdots \right) \dot{e} (\b r)~,
	\label{eq:hf.e.lw}
\end{align}
where the first term in the expansion is excluded since the total energy $E$ is conserved in time.\footnote{
\begin{align}
	\int \d^3 r \, \dot{e} (\b r) = \frac{\d}{\d t} \int \d^3 r \, e (\b r) = \frac{\d}{\d t} E = 0
	\quad\text{by Leibniz rule.}
\end{align}
}
From the first non-vanishing term, we obtain
\begin{align}
	\b J (t) = \frac{1}{V} \int \d^3 r ~ \b r \, \dot{e} (\b r)~,
	\label{eq:hf.J}
\end{align}
i.\,e.,~the heat flux is given as the first moment of the time derivative of the local energy density. 

In force-field approaches, it is common split the energy density into atomic contributions as
\begin{align}
	e (\b r, t ) = \sum_I E_I (t) \delta (\b r - \b R_I)~,
	\label{eq:hf.e.atomic}
\end{align}
the flux is then given by
\begin{align}
	\b J (t) 
		= \frac{1}{V} \frac{\d}{\d t} \sum_I E_I(t) \b R_I(t)
		= \frac{1}{V} \sum_I \dot{E}_I (t) \b R_I (t) + E_I (t) \dot{\b R}_I (t)~.
	\label{eq:hf.J.atomic}
\end{align}
\REM{Technically no! Take
	\begin{align}
		\dot e (\b r, t) = \sum_I \dot{E}_I \delta (\b r - \b R_I (t)) + E_I \dot{\b R}_I \cdot \nabla \delta (\b r - \b R_I)~,
	\end{align}
	then the second term always integrates to zero because it contains
	 a derivative of the delta function. One obtains
	\begin{align}
		\b J (t) = \frac{1}{V} \sum_I \dot{E}_I \b R_I (t)
	\end{align}
	which means the extra term $\b J_{\rm c} = \frac{1}{V} \sum_I E_I \dot{R}_I$, usually termed convective, is an artifact of integrating Eq.\,\eqref{eq:hf.J} incorrectly. This would explain why it is usually safe to neglect the term.
	}

\paragraph{Gauge invariance}
As seen above, the local current is only defined up to a non-heat carrying contribution $\b j_{\perp}$. Likewise, the energy density is only defined up to terms that keep the total energy integral unchanged. The choice of a local energy partitioning as,~e.\,g.,~given by Eq.\,\eqref{eq:hf.e.atomic} is therefore not unique, and different partitioning schemes will lead to differing heat fluxes. However, the thermal conductivity obtained by these heat fluxes will be the same in the long time limit~\cite{Ercole2016}.

\subsubsection{Ab initio Heat Flux}
The above formulas are readily applied when empirical force fields are used to describe the atomic interactions, as an atomic partitioning of the total energy is trivial in that case, although care must be taken in deriving the correct formulae nevertheless~\cite{Fan2015,Boone2019}. An \emph{ab initio} derivation of heat flux on the other hand was a long-standing problem because it was not clear how an expression of the form Eq.\,\eqref{eq:hf.J} or Eq.\,\eqref{eq:hf.J.atomic} can be obtained when no atomic partitioning is available. This problem was solved when Marcologno \emph{et al.} and Carbogno \emph{et al.} independently of each other arrived at well-defined heat flux expressions in \emph{ab initio} frameworks~\cite{Marcolongo2016,Carbogno2016}. We adopt the latter approach in the following, but present a derivation that slightly differs from Ref.\,\cite{Carbogno2016}.

% \paragraph{Derivation of ab initio Heat Flux}
We start the derivation from Eq.\,\eqref{eq:hf.J},~i.\,e.,~the definition of heat flux as the first moment of the energy density.

Recall Hamiltonian and define an energy density
\begin{align}
	H (\Gamma = (\b R, \b P)) = \sum_I \frac{\b P_I^2}{2 M_I} + V(\b R) 
		~\equiv~ \int \d^3 r ~ e (\b r, \Gamma)
\end{align}

Time derivative defines time derivate of energy density
\begin{align}
	\dot{H} (\Gamma)
		= \sum_I \b F_I \cdot \dot{\b R}_I + \frac{\partial V(\b R)}{\partial \b R_I} \cdot \dot{\b R}_I
			\label{eq:hf.ai.Hdot}
		\stackrel{!}{\equiv}
			\int \d r^3 ~ \dot{e} (\b r , \Gamma)~,
\end{align}
Note that the time derivate of the total energy vanishes, therefore $\dot{e} (\b r, \Gamma)$ needs to integrate to zero as well. The trivial solution is given by $e = H/V$ with vanishing time derivative. We are looking for non-trivial solutions.
To progess, please  note that as explained in Sec.\,\ref{sec:HellmannFeynman}, the force has a nuclear and an electronic contribution given by the two terms in Eq.\,\eqref{eq:hellmannfeynman.force}, so that
\begin{align}
	\b F_I
		&%= - \frac{\partial V (\b R)}{\partial \b R_I}  
			= \int \d^3 r ~ \b f_I^{\rm el} (\b r) + \sum_{J \neq I} \b F_{IJ}^{\rm Nuc} \quad\text{with}
		\label{eq:hf.ai.F}\\
	\b f_I^{\rm el} (\b r)
		&= - n(\b r) Z_I \frac{\b R_I - \b r}{\lvert \b R_I - \b r \rvert^3} \quad\text{and} \\
	\b F_{IJ}^{\rm Nuc}
		&= Z_I Z_J \frac{\b R_I - \b R_J}{\lvert \b R_I - \b R_J \rvert^3}~.
\end{align}

Therefore Eq.\,\eqref{eq:hf.ai.Hdot}
\begin{align}
	\dot{H} (\Gamma)
		&= \underset{I)}{\underbrace{\sum_I \b F_I \cdot \dot{\b R}_I}} ~ 
			 \underset{II)}{\underbrace{-\sum_{I} \int \d^3 r ~ \b f_I^{\rm el} (\b r) \cdot \dot{\b R}_I}}
			 \underset{III)}{\underbrace{-\sum_{I \neq J} \b F^{\rm Nuc}_{IJ} \cdot \dot{\b R}_I}} ~
\end{align}

Define three contributions to density $\dot{e} (\b r)$
\begin{subequations}
\begin{align}
	\text{I):}&&
		\dot{e}^{\rm kin} (\b r) &= \sum_I \b F_I \cdot \dot{\b R}_I \, \delta (\b R_I - \b r) \\
	\text{II):}&&
		\dot{e}^{\rm el} (\b r)  &= -\sum_{I} \b f_I^{\rm el} (\b r) \cdot \dot{\b R}_I \\
	\text{III):}&&
		\dot{e}^{\rm Nuc} (\b r) &= -\sum_{I \neq J} \b F^{\rm Nuc}_{IJ} \cdot \dot{\b R}_I \, \delta (\b R_J - \b r)
\end{align}
\label{eq:hf.ai.densities}
\end{subequations}

Easily verified:
\begin{align}
	\int \d^3 r ~ \left(\dot{e}^{\rm kin} (\b r) + \dot{e}^{\rm el} (\b r) + \dot{e}^{\rm Nuc} (\b r) \right)
	= \dot{H} (\Gamma)
	= 0~.
\end{align}

Use these densities in Eq.\,\eqref{eq:hf.J} to obtain heat flux:
\begin{align}
	\b J (\Gamma)
		% &= \frac{1}{V} \int \d^3 r ~ \b r \, \dot{e} (\b r, \Gamma) \\
		&= \frac{1}{V} \int \d^3 r ~ \b r \left( \dot{e}^{\rm kin} (\b r) + \dot{e}^{\rm el} (\b r) + \dot{e}^{\rm Nuc} (\b r)  \right) \\
		&= \frac{1}{V} \sum_I
			\left( 
				\b R_I \b F_I \cdot \dot{\b R}_I
				- \b R_J \int \d^3 r ~ \b f_I^{\rm el} (\b r) \cdot \dot{\b R}_I
				- \sum_{J \neq I} \b F^{\rm Nuc}_{IJ} \cdot \dot{\b R}_I
			\right)
\end{align}
By using Eq.\,\eqref{eq:hf.ai.F} and resolving the indices
\begin{align}
	J^\alpha (\Gamma) 
		=  \sum_I \frac{Z_I}{V}
			\left\{ 
				\sum_{J \neq I} Z_J \frac{(R_I^\alpha - R_J^\alpha) (R_I^\beta - R_J^\beta)}{\lvert \b R_I - \b R_J \rvert^3}
				- \int \d^3 r ~ n(\b r) \frac{(R_I^\alpha - r^\alpha) (R_I^\beta - r^\beta)}{\lvert \b R_I - \b r \vert^3}
			\right\}
			R^\beta_I~.
\end{align}



\subsubsection{Ab initio Green Kubo}